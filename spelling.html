<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Little Master: Spelling Bee</title>
    
    <!-- Kids Font -->
    <link href="https://fonts.googleapis.com/css2?family=Bubblegum+Sans&display=swap" rel="stylesheet">
    
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Bubblegum Sans', cursive;
            background: linear-gradient(180deg, #E1BEE7 0%, #BA68C8 100%);
            height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            color: #333;
        }

        /* --- HOME BUTTON --- */
        .home-btn {
            position: absolute; top: 15px; left: 15px;
            background: white; border: 3px solid #fff; border-radius: 50%;
            width: 50px; height: 50px; font-size: 28px;
            cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 200; display: flex; align-items: center;
            justify-content: center; text-decoration: none;
        }

        /* --- START SCREEN --- */
        #startScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(180deg, #E1BEE7 0%, #BA68C8 100%);
            z-index: 10000; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
        }

        .play-btn {
            background: #8E24AA; color: white; font-size: 28px;
            padding: 15px 50px; border: none; border-radius: 50px;
            font-family: 'Bubblegum Sans', cursive; font-weight: bold;
            box-shadow: 0 6px 0 #4A148C; cursor: pointer;
            animation: pulse 1.5s infinite; margin-top: 20px;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* --- GAME AREA --- */
        .game-wrapper {
            flex: 1; display: none; flex-direction: column;
            align-items: center; justify-content: center;
            width: 100%; padding-bottom: 60px;
        }

        .mascot-display {
            height: 90px; margin-bottom: 5px;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2));
        }

        .card {
            background: white; padding: 20px; border-radius: 30px;
            width: 90%; max-width: 380px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); border: 5px solid #fff;
            display: flex; flex-direction: column; justify-content: center;
            align-items: center;
        }

        /* Image Area */
        .question-img {
            font-size: 80px; margin: 10px 0;
            filter: drop-shadow(0 4px 2px rgba(0,0,0,0.2));
            height: 100px; display: flex; align-items: center; justify-content: center;
        }
        .img-mode { max-width: 120px; max-height: 100px; object-fit: contain; }

        /* ANSWER SLOTS */
        .answer-container {
            display: flex; gap: 8px; justify-content: center;
            margin: 15px 0; min-height: 60px; width: 100%;
            flex-wrap: wrap;
        }

        .letter-slot {
            width: 50px; height: 50px;
            background: #F3E5F5; border: 2px dashed #AB47BC;
            border-radius: 10px; display: flex;
            align-items: center; justify-content: center;
            font-size: 28px; font-weight: bold; color: #8E24AA;
            text-transform: uppercase;
        }
        .slot-filled {
            background: #E1BEE7; border: 2px solid #8E24AA; color: #4A148C;
            animation: popIn 0.2s;
        }

        /* KEYBOARD AREA */
        .keyboard-area {
            display: flex; flex-wrap: wrap; gap: 10px;
            justify-content: center; margin-top: 10px;
            width: 100%;
        }

        .key-btn {
            width: 50px; height: 50px; background: #FFEB3B;
            border: none; border-radius: 10px;
            font-family: 'Bubblegum Sans', cursive;
            font-size: 26px; color: #F57F17;
            box-shadow: 0 4px 0 #FBC02D; cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
        }
        .key-btn:active { transform: translateY(4px); box-shadow: none; }
        .key-used { opacity: 0.4; pointer-events: none; transform: scale(0.9); box-shadow: none; background: #E0E0E0; color: #aaa; }

        /* Highlight Animation for Auto Speak */
        .key-highlight {
            transform: scale(1.25) !important;
            background-color: #FFCA28 !important; /* Brighter */
            box-shadow: 0 0 15px #FF6F00 !important;
            z-index: 100;
            border: 2px solid #FFF;
        }

        /* ACTIONS */
        .action-row {
            display: flex; gap: 15px; margin-top: 25px; width: 100%; justify-content: center;
        }
        
        .action-btn {
            border: none; padding: 10px 25px; border-radius: 20px; cursor: pointer;
            font-family: 'Bubblegum Sans', cursive; font-size: 20px; color: white;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2); transition: transform 0.1s;
            display: flex; align-items: center; gap: 8px;
        }
        .action-btn:active { transform: translateY(4px); box-shadow: none; }

        .clear-btn { background: #FF5722; box-shadow: 0 4px 0 #E64A19; }
        .check-btn { background: #4CAF50; box-shadow: 0 4px 0 #2E7D32; animation: bounceBtn 2s infinite; }
        
        @keyframes bounceBtn { 0%, 100% {transform: scale(1);} 50% {transform: scale(1.05);} }
        @keyframes popIn { from {transform:scale(0);} to {transform:scale(1);} }
        .shake { animation: shake 0.4s; }
        @keyframes shake { 0%, 100% {transform:translateX(0);} 25% {transform:translateX(-10px);} 75% {transform:translateX(10px);} }

        /* ADS */
        .ad-box-rect {
            width: 300px; height: 250px; background: #fff;
            display: flex; justify-content: center; align-items: center;
            margin: 20px 0; border: 2px dashed #ccc;
        }
        .ad-bottom {
            position: fixed; bottom: 0; width: 100%; height: 50px;
            background: #fff; border-top: 1px solid #ccc;
            display: flex; justify-content: center; align-items: center; z-index: 9000;
        }

        /* MODALS */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none;
            justify-content: center; align-items: center; z-index: 11000;
        }
        .modal-box {
            background: white; padding: 25px; border-radius: 25px;
            text-align: center; width: 90%; max-width: 320px;
        }
    </style>
</head>
<body>

    <!-- 1. POPUNDER ADS -->
    <script src="https://pl21772533.effectivegatecpm.com/8c/b6/66/8cb6663167876148ce98818f0eabaad8.js"></script>

    <!-- START SCREEN -->
    <div id="startScreen">
        <a href="index.html" class="home-btn">üè†</a>
        <h1 style="color: #4A148C; font-size: 35px; margin-bottom: 5px;">Spelling Bee üêù</h1>
        <p style="color: #fff; margin-top: 0;">Learn to Spell Words!</p>
        
        <div class="ad-box-rect">
            <script type="text/javascript">
                atOptions = { 'key' : 'd30662a773f82e053b64b8591ab5444c', 'format' : 'iframe', 'height' : 250, 'width' : 300, 'params' : {} };
                document.write('<scr' + 'ipt type="text/javascript" src="http' + (location.protocol === 'https:' ? 's' : '') + '://www.highperformanceformat.com/d30662a773f82e053b64b8591ab5444c/invoke.js"></scr' + 'ipt>');
            </script>
        </div>
        
        <button class="play-btn" onclick="startGame()">‚ñ∂ Start Game</button>
    </div>

    <!-- GAME WRAPPER -->
    <div class="game-wrapper" id="gameWrapper">
        <a href="index.html" class="home-btn">üè†</a>
        <img src="talkingof.PNG" id="mascotImage" class="mascot-display" alt="Mascot">
        
        <div class="card" id="gameCard">
            <p style="margin:0; color:#888;">Spell this:</p>
            
            <!-- Question Image -->
            <div id="qImageContainer"></div>
            
            <!-- Answer Slots -->
            <div class="answer-container" id="answerBox"></div>

            <!-- Jumbled Keys -->
            <div class="keyboard-area" id="keyboardBox"></div>

            <!-- Action Buttons -->
            <div class="action-row">
                <button class="action-btn clear-btn" onclick="clearSlots()">‚ùå Clear</button>
                <button class="action-btn check-btn" onclick="checkAnswer()">‚úÖ Check</button>
            </div>
        </div>
    </div>

    <!-- BOTTOM AD -->
    <div class="ad-bottom">
        <script type="text/javascript">
            atOptions = { 'key' : '66159e73d9894e59c14c0570abaee84e', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} };
            document.write('<scr' + 'ipt type="text/javascript" src="http' + (location.protocol === 'https:' ? 's' : '') + '://www.highperformanceformat.com/66159e73d9894e59c14c0570abaee84e/invoke.js"></scr' + 'ipt>');
        </script>
    </div>

    <!-- MODALS -->
    <div class="modal-overlay" id="wrongModal">
        <div class="modal-box">
            <div style="font-size: 60px;">üòµ</div>
            <h2 style="color: #F44336;">Wrong Spelling!</h2>
            <button class="play-btn" style="background:#F44336; margin-top:10px;" onclick="closeWrongModal()">Try Again</button>
        </div>
    </div>

    <div class="modal-overlay" id="finishModal">
        <div class="modal-box">
            <div style="font-size: 60px;">üèÜ</div>
            <h2 style="color: #4CAF50;">You are a Master!</h2>
            <p>All Words Completed!</p>
            <button class="play-btn" style="background:#2196F3;" onclick="restartFullGame()">Play Again</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        // --- SPELLING DATA ---
        const spellData = [
            { word: "CAT", img: "üê±" },
            { word: "DOG", img: "üê∂" },
            { word: "BAT", img: "ü¶á" },
            { word: "SUN", img: "‚òÄÔ∏è" },
            { word: "ANT", img: "üêú" },
            { word: "BUS", img: "üöå" },
            { word: "CAR", img: "üöó" },
            { word: "BALL", img: "‚öΩ" },
            { word: "FISH", img: "üêü" },
            { word: "BIRD", img: "üê¶" },
            { word: "STAR", img: "‚≠ê" },
            { word: "TREE", img: "üå≥" },
            { word: "BOOK", img: "üìñ" },
            { word: "LION", img: "ü¶Å" },
            { word: "DUCK", img: "ü¶Ü" },
            { word: "APPLE", img: "üçé" },
            { word: "HOUSE", img: "üè†" },
            { word: "KITE", img: "ü™Å" },
            { word: "MOON", img: "üåô" },
            { word: "CAKE", img: "üéÇ" }
        ];

        let currentIndex = 0;
        let currentWord = "";
        let enteredLetters = [];

        // --- üîä SOUND SYSTEM ---
        function playSound(text) {
            const mascot = document.getElementById('mascotImage');
            if(mascot) mascot.src = "talkingof.gif";

            let fileName = "";
            if (text.length === 1) {
                // A-Z letters
                fileName = text.toLowerCase() + ".mp3";
            } else if (text.startsWith("Spell ")) {
                let wordOnly = text.replace("Spell ", "").toLowerCase();
                fileName = wordOnly + ".mp3";
            } else {
                fileName = text.toLowerCase() + ".mp3";
            }

            let audio = new Audio(fileName);
            audio.onended = () => { if(mascot) mascot.src = "talkingof.PNG"; };
            audio.onerror = () => {
                // Fallback TTS
                const synth = window.speechSynthesis;
                const u = new SpeechSynthesisUtterance(text);
                u.rate = 0.9;
                u.onend = () => { if(mascot) mascot.src = "talkingof.PNG"; };
                synth.speak(u);
            };
            audio.play().catch(e => {
                const synth = window.speechSynthesis;
                const u = new SpeechSynthesisUtterance(text);
                synth.speak(u);
                if(mascot) mascot.src = "talkingof.PNG";
            });
        }

        // --- GAME LOGIC ---
        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameWrapper').style.display = 'flex';
            
            const saved = localStorage.getItem('spellingLevel');
            if(saved && !isNaN(saved)) { currentIndex = parseInt(saved); } 
            else { currentIndex = 0; }
            
            loadLevel();
        }

        function loadLevel() {
            if(!spellData[currentIndex]) currentIndex = 0;
            if(currentIndex >= spellData.length) {
                document.getElementById('finishModal').style.display = 'flex';
                if(typeof confetti === 'function') confetti();
                return;
            }

            const data = spellData[currentIndex];
            currentWord = data.word;
            enteredLetters = [];

            // 1. Show Image
            const imgBox = document.getElementById('qImageContainer');
            if(data.img.includes('.')) {
                imgBox.innerHTML = `<img src="${data.img}" class="question-img img-mode">`;
            } else {
                imgBox.innerHTML = `<div class="question-img">${data.img}</div>`;
            }

            // 2. Speak Instruction
            setTimeout(() => { playSound("Spell " + currentWord); }, 500);

            // 3. Create Empty Slots
            const answerBox = document.getElementById('answerBox');
            answerBox.innerHTML = "";
            for(let i=0; i<currentWord.length; i++) {
                const slot = document.createElement('div');
                slot.className = 'letter-slot';
                slot.id = 'slot-'+i;
                answerBox.appendChild(slot);
            }

            // 4. Create Jumbled Keyboard (Correct + 2 Decoys)
            let letters = currentWord.split('');
            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            letters.push(alphabet[Math.floor(Math.random() * 26)]); 
            letters.push(alphabet[Math.floor(Math.random() * 26)]); 
            letters.sort(() => Math.random() - 0.5); 

            const keyBox = document.getElementById('keyboardBox');
            keyBox.innerHTML = "";
            
            // Generate Buttons
            letters.forEach((l, idx) => {
                const key = document.createElement('button');
                key.className = 'key-btn';
                key.innerText = l;
                key.id = 'key-'+idx;
                key.onclick = () => {
                    playSound(l);
                    handleInput(l, key);
                };
                keyBox.appendChild(key);
            });

            // 5. üî• AUTO PLAY SEQUENCE (SPEAK ALL BUTTONS) üî•
            const allKeyButtons = document.querySelectorAll('.key-btn');
            let delayTimer = 2500; // Start after 2.5 seconds (giving time for "Spell Word")

            allKeyButtons.forEach((btn) => {
                const letter = btn.innerText;
                
                setTimeout(() => {
                    // Play Sound of specific letter on screen
                    playSound(letter);

                    // Visual Highlight
                    btn.classList.add('key-highlight');
                    setTimeout(() => { btn.classList.remove('key-highlight'); }, 600);

                }, delayTimer);

                // Increment delay for next letter
                delayTimer += 1200; // 1.2 second gap
            });
        }

        function handleInput(letter, btnElement) {
            if(enteredLetters.length < currentWord.length) {
                enteredLetters.push(letter);
                
                const slotIndex = enteredLetters.length - 1;
                const slot = document.getElementById('slot-'+slotIndex);
                if(slot) {
                    slot.innerText = letter;
                    slot.classList.add('slot-filled');
                }
                
                btnElement.classList.add('key-used');
                btnElement.classList.remove('key-highlight');
            }
        }

        function clearSlots() {
            enteredLetters = [];
            const slots = document.querySelectorAll('.letter-slot');
            slots.forEach(s => {
                s.innerText = "";
                s.classList.remove('slot-filled');
                s.style.backgroundColor = '#F3E5F5';
            });
            const keys = document.querySelectorAll('.key-btn');
            keys.forEach(k => k.classList.remove('key-used'));
        }

        function checkAnswer() {
            if(enteredLetters.length < currentWord.length) {
                playSound("Complete the word"); 
                const card = document.getElementById('gameCard');
                card.classList.add('shake');
                setTimeout(() => card.classList.remove('shake'), 400);
                return;
            }

            const attempt = enteredLetters.join('');
            if(attempt === currentWord) {
                if(typeof confetti === 'function') confetti();
                playSound("Correct"); 
                
                const slots = document.querySelectorAll('.letter-slot');
                slots.forEach(s => s.style.backgroundColor = '#C8E6C9');

                setTimeout(() => {
                    currentIndex++;
                    localStorage.setItem('spellingLevel', currentIndex);
                    loadLevel();
                }, 1500);

            } else {
                playSound("Wrong"); 
                const card = document.getElementById('gameCard');
                card.classList.add('shake');
                setTimeout(() => card.classList.remove('shake'), 400);
                
                setTimeout(() => {
                    document.getElementById('wrongModal').style.display = 'flex';
                }, 600);
            }
        }

        function closeWrongModal() {
            document.getElementById('wrongModal').style.display = 'none';
            clearSlots();
        }

        function restartFullGame() {
            currentIndex = 0;
            localStorage.setItem('spellingLevel', 0);
            location.reload();
        }
    </script>
</body>
</html>